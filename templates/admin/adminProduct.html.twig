{% extends 'base.admin.html.twig' %}

{% block title %}Admin Panel{% endblock %}

{% block admin_body %}
<style>
    .admin-product-wrapper {
        padding: 20px;
    }
    .admin-product-title {
        color: #61c087;
        margin-bottom: 20px;
    }
    .admin-product-subtitle {
        color: #757575;
        line-height: 1.6;
    }
    .admin-product-list {
        margin-top: 20px;
    }
    .admin-product-list a {
        display: block;
        margin-bottom: 10px;
        color: #000;
        text-decoration: none;
    }
    .admin-product-list a:hover {
        color: #61c087;
    }
    .admin-product-image {
        width: 60%;
        height: auto;
        margin-top: 20px;
    }
    .table-editable input,
    .table-editable textarea {
        width: 100%;
        border: none;
        background: transparent;
        resize: none;
    }
    .table-editable input:focus,
    .table-editable textarea:focus {
        outline: none;
        background: #f8f9fa;
    }
    .table-editable .btn {
        margin-top: 10px;
    }
</style>

<div class="justify-content-center admin-product-wrapper">
    <h2 class="admin-product-title">Gestion des Produits</h2>
    <h4 class="admin-product-subtitle">
        Vous pouvez ajouter, modifier ou supprimer des produits.
    </h4>
    <div class="rounded-3 shadow-lg" style="min-width: 63vw;">
        <div class="card-body">
            <h4 class="card-title">Ajouter un produit</h4>
            {% if categories|length >= 1 %}
                <form method="POST" class="mb-3" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="title" class="form-label">Titre</label>
                        <input type="text" class="form-control" id="title" name="title" maxlength="100" placeholder="Titre" required>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" maxlength="1000" placeholder="Description" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="price" class="form-label">Prix en €</label>
                        <input type="number" class="form-control" id="price" name="price" placeholder="Prix" min="0.01" max="999.99" step="0.01" required>
                    </div>
                    <div class="mb-3">
                        <label for="category_id" class="form-label">Catégorie</label>
                        <select class="form-control" id="category_id" name="category_id" required>
                            {% for category in categories %}
                                <option value="{{ category.id }}">{{ category.title }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="image" class="form-label">Image</label>
                        <input type="file" class="form-control" id="image" name="image" accept="image/*">
                    </div>
                    <button type="submit" class="btn btn-primary" name="add_product">Ajouter Produit</button>
                </form>
            {% else %}
                <div class="alert alert-warning" role="alert">
                    Aucune catégorie trouvée. Veuillez ajouter une 
                    <a href="/admin/category" class="alert-link">catégorie</a>
                    pour pouvoir ajouter un produit.
                </div>
            {% endif %}

            <h4 class="card-title">Liste des produits</h4>
            <div class="table-responsive">
                {% if products|length >= 1 %}
                    {% for category in categories %}
                        {% set categoryProducts = products|filter(product => product.category.id == category.id) %}
                        {% if categoryProducts|length > 0 %}
                            <h5 class="mt-4">{{ category.title }}</h5>
                            <table class="table table-editable table-nowrap align-middle table-edits w-100">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Titre</th>
                                        <th>Description</th>
                                        <th>Prix en €</th>
                                        <th>Image</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for product in categoryProducts %}
                                        <tr>
                                            <form method="POST">
                                                <td>{{ product.id }}</td>
                                                <td>
                                                    <input type="hidden" name="id" value="{{ product.id }}">
                                                    <input type="text" name="title" value="{{ product.title }}" maxlength="255" required>
                                                </td>
                                                <td>
                                                    <textarea name="description" maxlength="1000" required>{{ product.description }}</textarea>
                                                </td>
                                                <td>
                                                    <input type="number" name="price" value="{{ product.price }}" min="0.01" max="999.99" step="0.01" required>
                                                </td>
                                                <td>
                                                    {% if product.image %}
                                                    <a href="{{ asset('images/' ~ product.image) }}" target="_blank">Voir l'image</a>
                                                    {% endif %}
                                                    {% if not product.image %}
                                                    <span>Aucune image</span>
                                                    {% endif %}
                                                </td>
                                                <td style="width: 150px;">
                                                    <button type="submit" class="btn btn-warning btn-sm" name="edit_product">Modifier</button>
                                                    <button type="submit" class="btn btn-danger btn-sm" name="delete_product">Supprimer</button>
                                                </td>
                                            </form>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <h5 class="mt-4">{{ category.title }}</h5>
                            <div class="text-center fs-3">Aucun produit trouvé pour cette catégorie</div>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <div class="text-center fs-3">Aucun produit trouvé</div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}